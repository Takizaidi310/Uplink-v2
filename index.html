<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UPLINK v4 // OMEGA SHELL</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        :root {
            --term-green: #33ff00;
            --term-dim: #1a8000;
            --term-bg: #050505;
            --term-panel: #111;
            --alert: #ff3333;
            --font-stack: 'Courier New', 'Lucida Console', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--term-bg);
            color: var(--term-green);
            font-family: var(--font-stack);
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
            text-shadow: 0 0 2px rgba(51, 255, 0, 0.4);
        }

        /* --- VISUAL EFFECTS --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 999; opacity: 0.4;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.8) 100%);
            pointer-events: none; z-index: 998;
        }

        /* --- LAYOUT --- */
        #main-ui {
            display: flex; flex-direction: column; height: 100%;
            position: relative; z-index: 10;
        }

        /* SLIDING VIDEO PANEL */
        #call-panel {
            position: fixed; top: 0; left: 0; width: 100%; 
            height: 40vh; min-height: 250px;
            background: var(--term-panel);
            border-bottom: 2px solid var(--term-green);
            transform: translateY(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 50;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        #call-panel.open { transform: translateY(0); }

        #video-grid {
            flex-grow: 1; padding: 10px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px; overflow-y: auto;
        }
        
        .vid-container {
            position: relative; border: 1px solid var(--term-dim);
            background: #000; aspect-ratio: 4/3;
        }
        video {
            width: 100%; height: 100%; object-fit: cover;
            filter: sepia(1) hue-rotate(50deg) contrast(1.2) saturate(0.8);
        }
        .vid-label {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.7); color: var(--term-green);
            font-size: 10px; padding: 2px 4px; text-align: center;
        }

        /* CALL CONTROLS */
        #call-controls {
            display: flex; justify-content: center; gap: 10px; padding: 10px;
            background: #000; border-top: 1px solid var(--term-dim);
        }
        .btn-control {
            background: transparent; border: 1px solid var(--term-green); color: var(--term-green);
            padding: 5px 15px; cursor: pointer; font-family: var(--font-stack); text-transform: uppercase;
            font-size: 10px; min-width: 80px;
        }
        .btn-control:hover { background: var(--term-green); color: black; }
        .btn-danger { border-color: var(--alert); color: var(--alert); }
        .btn-danger:hover { background: var(--alert); color: black; }
        .btn-active { background: var(--term-green); color: black; }

        /* HEADER */
        .header {
            padding: 10px 15px; border-bottom: 1px solid var(--term-dim);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.9); flex-shrink: 0;
        }
        .status-badge { background: var(--term-green); color: black; padding: 2px 6px; font-weight: bold; font-size: 0.8rem; }
        .status-offline { background: var(--alert); }
        
        #active-nodes {
            font-size: 0.7em; margin-left: 15px; color: var(--term-dim);
            display: none; 
        }
        @media(min-width: 600px) { #active-nodes { display: inline; } }

        /* TOGGLE BUTTON FOR PANEL */
        #panel-toggle {
            cursor: pointer; border: 1px solid var(--term-dim); padding: 2px 8px;
            font-size: 0.8rem; margin-right: 10px; display: none;
        }
        #panel-toggle:hover { border-color: var(--term-green); }

        /* CHAT AREA */
        #console-output {
            flex-grow: 1; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 6px;
            scrollbar-width: thin; scrollbar-color: var(--term-dim) transparent;
        }
        
        .line { display: flex; gap: 10px; line-height: 1.4; animation: glitchText 0.1s; }
        .ts { color: var(--term-dim); flex-shrink: 0; width: 70px; font-size: 0.85em; }
        .user { font-weight: bold; flex-shrink: 0; color: #fff; }
        .sys { color: var(--term-green); font-style: italic; opacity: 0.8; }
        .msg-content { word-wrap: break-word; overflow-wrap: anywhere; max-width: 100%; color: var(--term-green); }
        
        /* MEDIA IN CHAT */
        .chat-img { 
            max-width: 250px; border: 1px solid var(--term-dim); margin-top: 5px; 
            filter: grayscale(100%) contrast(1.2); transition: 0.3s;
        }
        .chat-img:hover { filter: none; }
        .chat-video { max-width: 250px; border: 1px solid var(--term-dim); margin-top: 5px; }
        .file-link { 
            display: inline-block; border: 1px solid var(--term-green); padding: 5px 10px; 
            margin-top: 5px; text-decoration: none; color: var(--term-green); font-size: 0.8em;
        }
        .file-link:hover { background: var(--term-green); color: black; }

        /* INPUT AREA */
        .input-bar {
            display: flex; align-items: center;
            border-top: 1px solid var(--term-dim); padding: 10px;
            background: var(--term-bg); flex-shrink: 0;
        }
        .prompt { margin-right: 10px; font-weight: bold; color: var(--term-green); display:none; }
        @media(min-width: 600px) { .prompt { display: inline; } }
        
        #cmd-input {
            flex-grow: 1; background: transparent; border: none;
            color: var(--term-green); font-family: var(--font-stack); font-size: 1rem;
            outline: none;
        }
        .upload-btn {
            border: 1px solid var(--term-dim); color: var(--term-dim);
            padding: 5px 10px; cursor: pointer; margin-right: 10px; font-size: 0.9em;
        }
        .upload-btn:hover { color: var(--term-green); border-color: var(--term-green); }

        /* AUTH SCREEN */
        #auth-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--term-bg); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .ascii-art { font-size: 10px; line-height: 10px; white-space: pre; margin-bottom: 20px; color: var(--term-green); }
        .auth-input { 
            background: transparent; border: none; border-bottom: 2px solid var(--term-dim);
            color: var(--term-green); font-family: var(--font-stack); font-size: 1.2rem;
            text-align: center; width: 200px; outline: none; margin-top: 10px;
        }
        
        .hidden { display: none !important; }
        @keyframes glitchText { 0% { opacity: 0.8; transform: translateX(-2px); } 100% { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div id="auth-overlay">
        <div class="ascii-art">
  _   _  ____  _      ___  _   _  _  __
 | | | ||  _ \| |    |_ _|| \ | || |/ /
 | | | || |_) | |     | | |  \| || ' / 
 | |_| ||  __/| |___  | | | |\  || . \ 
  \___/ |_|   |_____||___||_| \_||_|\_\
        </div>
        <p>> ESTABLISHING SECURE HANDSHAKE...</p>
        <br>
        <div id="step-1">
            <p>ENTER OPERATIVE CODENAME:</p>
            <input type="text" id="auth-user" class="auth-input" autofocus onkeydown="handleAuth(event)">
        </div>
        
        <div id="step-2" class="hidden" style="text-align:center; margin-top:20px;">
            <p>ENTER ENCRYPTION KEY (CHANNEL):</p>
            <input type="text" id="auth-freq" class="auth-input" onkeydown="handleConnect(event)">
        </div>
        <div id="boot-log" style="margin-top:20px; color:var(--term-dim); font-size:12px; height:20px;"></div>
    </div>

    <div id="main-ui" class="hidden">
        
        <div id="call-panel">
            <div id="video-grid"></div>
            <div id="call-controls">
                <button class="btn-control" onclick="toggleMute()" id="btn-mute">MUTE MIC</button>
                <button class="btn-control" onclick="toggleCam()" id="btn-cam">CAM OFF</button>
                <button class="btn-control" onclick="togglePanel()">HIDE PANEL</button>
                <button class="btn-control btn-danger" onclick="leaveCall()">END CALL</button>
            </div>
        </div>

        <div class="header">
            <div style="display:flex; align-items:center;">
                <span id="panel-toggle" onclick="togglePanel()">[CAM]</span>
                <span>UPLINK v4 Made by Taki Zaidi<span style="font-size:0.7em; color:var(--term-dim);">// SECURE</span></span>
                <span id="active-nodes">NODES: 0</span>
            </div>
            <span id="net-stat" class="status-badge status-offline">OFFLINE</span>
        </div>

        <div id="console-output"></div>

        <div class="input-bar">
            <span class="upload-btn" onclick="document.getElementById('file-upload').click()">[+] FILE</span>
            <input type="file" id="file-upload" hidden onchange="handleFileUpload(this)">
            <span class="prompt" id="prompt-user">GHOST:~$</span>
            <input type="text" id="cmd-input" autocomplete="off" placeholder="Message or /cmd..." onkeydown="handleCommand(event)">
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const BROKER = 'wss://broker.hivemq.com:8884/mqtt';
        const BASE_TOPIC = 'uplink_omega_v4_'; 
        
        // --- STATE ---
        let client;
        let username = '';
        let channelKey = '';
        let fullTopic = '';
        let signalTopic = '';
        let isConnected = false;
        let activeNodes = new Map(); // Stores { username: lastPingTime }
        
        // WebRTC
        let localStream = null;
        let peers = {}; 
        let isInCall = false;
        const rtcConfig = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        // --- SOUND & VOICE ENGINE ---
        const SoundFX = {
            ctx: null,
            init: function() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play: function(freq, type, dur, vol=0.05) {
                if(!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type; osc.frequency.value = freq;
                osc.connect(gain); gain.connect(this.ctx.destination);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
                osc.start(); osc.stop(this.ctx.currentTime + dur);
            },
            click: function() { this.play(800, 'square', 0.05); },
            msg: function() { this.play(1200, 'sine', 0.1); setTimeout(()=>this.play(1800,'sine',0.1), 100); },
            alert: function() { this.play(150, 'sawtooth', 0.3); }
        };

        const VoiceSys = {
            enabled: true,
            synth: window.speechSynthesis,
            speak: function(text) {
                if(!this.enabled) return;
                // Simple filter to not read URLs or heavy data
                if(text.includes('data:image') || text.length > 200) return; 
                
                const utter = new SpeechSynthesisUtterance(text);
                const voices = this.synth.getVoices();
                utter.voice = voices.find(v => v.name.includes('Google US English')) || voices[0];
                utter.pitch = 0.8; utter.rate = 1.1; utter.volume = 0.6;
                this.synth.speak(utter);
            }
        };

        // --- AUTH LOGIC ---
        function handleAuth(e) {
            SoundFX.init();
            if(e.key === 'Enter' && e.target.value.trim()) {
                SoundFX.click();
                username = e.target.value.trim().toUpperCase();
                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-2').classList.remove('hidden');
                document.getElementById('auth-freq').focus();
            }
        }

        function handleConnect(e) {
            if(e.key === 'Enter' && e.target.value.trim()) {
                SoundFX.click();
                channelKey = e.target.value.trim();
                fullTopic = BASE_TOPIC + 'chat_' + channelKey; 
                signalTopic = BASE_TOPIC + 'sig_' + CryptoJS.MD5(channelKey).toString();
                
                e.target.disabled = true;
                const log = document.getElementById('boot-log');
                
                let steps = ["INITIALIZING BIOS...", "BYPASSING FIREWALL...", "ENCRYPTING STREAM...", "ACCESS GRANTED."];
                let i = 0;
                let int = setInterval(() => {
                    if(i < steps.length) {
                        log.innerText = "> " + steps[i];
                        SoundFX.click();
                        i++;
                    } else {
                        clearInterval(int);
                        document.getElementById('auth-overlay').classList.add('hidden');
                        initSystem();
                    }
                }, 400);
            }
        }

        function initSystem() {
            document.getElementById('main-ui').classList.remove('hidden');
            document.getElementById('prompt-user').innerText = `${username}:~$`;
            printLog("SYSTEM", `WELCOME AGENT ${username}. SECURE SHELL ACTIVE.`);
            VoiceSys.speak("System online.");
            connectMQTT();
            
            // Heartbeat Loop
            setInterval(() => {
                publish(fullTopic, { type: 'heartbeat', sender: username });
                pruneActiveNodes();
            }, 5000);
        }

        // --- ENCRYPTION ---
        function pack(data) {
            try { return CryptoJS.AES.encrypt(JSON.stringify(data), channelKey).toString(); } catch(e){ return null; }
        }
        function unpack(ciphertext) {
            try { return JSON.parse(CryptoJS.AES.decrypt(ciphertext, channelKey).toString(CryptoJS.enc.Utf8)); } catch(e){ return null; }
        }

        // --- MQTT ---
        function connectMQTT() {
            const clientId = 'uplink_usr_' + Math.random().toString(16).substr(2, 8);
            client = mqtt.connect(BROKER, { keepalive: 60, clientId: clientId });

            client.on('connect', () => {
                isConnected = true;
                updateStatus(true);
                client.subscribe(fullTopic);
                client.subscribe(signalTopic);
                publish(fullTopic, { type: 'join', sender: username });
            });

            client.on('message', (topic, msg) => {
                const payload = unpack(msg.toString());
                if(!payload) return;

                if (topic === fullTopic) handleChat(payload);
                if (topic === signalTopic) handleSignal(payload);
            });

            client.on('offline', () => updateStatus(false));
        }

        function publish(topic, data) {
            if(!isConnected) return;
            const encrypted = pack(data);
            if(encrypted) client.publish(topic, encrypted);
        }

        // --- CHAT & LOGIC ---
        function handleCommand(e) {
            if(e.key === 'Enter') {
                const val = e.target.value.trim();
                e.target.value = '';
                if(!val) return;
                SoundFX.click();

                if(val.startsWith('/')) {
                    const parts = val.split(' ');
                    const cmd = parts[0].toLowerCase();
                    if(cmd === '/upload') document.getElementById('file-upload').click();
                    else if(cmd === '/call') startCall();
                    else if(cmd === '/mute') { VoiceSys.enabled = false; printLog("SYSTEM", "VOICE OUTPUT MUTED."); }
                    else if(cmd === '/unmute') { VoiceSys.enabled = true; printLog("SYSTEM", "VOICE OUTPUT ACTIVE."); }
                    else if(cmd === '/users') listUsers();
                    else if(cmd === '/clear') document.getElementById('console-output').innerHTML = '';
                    else if(cmd === '/help') printLog("SYSTEM", "CMDS: /upload, /call, /mute, /unmute, /users, /clear");
                    else printLog("SYSTEM", "UNKNOWN COMMAND.");
                } else {
                    // Send message
                    publish(fullTopic, { type: 'msg', sender: username, text: val, ts: Date.now() });
                    // Echo to self immediately (Feature Restored)
                    printLog(username, val);
                }
            }
        }

        function handleChat(data) {
            // Update presence for everyone who talks
            updateActiveNode(data.sender);

            if(data.sender === username) return; // Ignore self reflection from server

            if(data.type === 'msg') {
                printLog(data.sender, data.text);
                SoundFX.msg();
                VoiceSys.speak(data.text); // Voice Feature Restored
            } else if (data.type === 'file') {
                printFile(data.sender, data.fileData, data.fileName, data.fileType);
                SoundFX.msg();
                VoiceSys.speak("File received.");
            } else if (data.type === 'join') {
                printLog("SYSTEM", `${data.sender} HAS CONNECTED.`);
            } else if (data.type === 'heartbeat') {
                // Already handled by updateActiveNode
            }
        }

        // --- ACTIVE USERS (Presence) ---
        function updateActiveNode(user) {
            activeNodes.set(user, Date.now());
            updateHeaderNodes();
        }

        function pruneActiveNodes() {
            const now = Date.now();
            for (let [user, lastSeen] of activeNodes) {
                if (now - lastSeen > 15000) activeNodes.delete(user);
            }
            updateHeaderNodes();
        }

        function updateHeaderNodes() {
            const count = activeNodes.size;
            document.getElementById('active-nodes').innerText = `NODES: ${count}`;
        }
        
        function listUsers() {
            let users = Array.from(activeNodes.keys()).join(', ');
            printLog("SYSTEM", `ACTIVE OPERATIVES: [ ${users} ]`);
        }

        // --- UI RENDER ---
        function printLog(sender, content, isHtml=false) {
            const box = document.getElementById('console-output');
            const div = document.createElement('div');
            div.className = 'line';
            const time = new Date().toLocaleTimeString('en-US', {hour12:false, hour:'2-digit', minute:'2-digit'});
            
            let colorClass = sender === 'SYSTEM' ? 'sys' : 'user';
            
            div.innerHTML = `<span class="ts">[${time}]</span><span class="${colorClass}">${sender}:</span><span class="msg-content">${isHtml ? content : escapeHtml(content)}</span>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        function escapeHtml(text) { return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }

        function updateStatus(online) {
            const el = document.getElementById('net-stat');
            el.innerText = online ? "ONLINE (SECURE)" : "OFFLINE";
            el.className = online ? "status-badge" : "status-badge status-offline";
        }

        // --- FILE HANDLING ---
        function handleFileUpload(input) {
            const file = input.files[0];
            if(!file) return;
            if(file.size > 800000) { printLog("SYSTEM", "ERROR: FILE TOO LARGE (MAX 800KB)."); return; }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                publish(fullTopic, { type: 'file', sender: username, fileName: file.name, fileType: file.type, fileData: base64 });
                printFile(username, base64, file.name, file.type);
            };
            reader.readAsDataURL(file);
            input.value = ''; 
        }

        function printFile(sender, data, name, type) {
            let html = '';
            if(type.startsWith('image/')) html = `<br><img src="${data}" class="chat-img">`;
            else if (type.startsWith('video/')) html = `<br><video src="${data}" controls class="chat-video"></video>`;
            else html = `<br><a href="${data}" download="${name}" class="file-link">[DOWNLOAD: ${name}]</a>`;
            printLog(sender, `SHARED DATA: ${name} ${html}`, true);
        }

        // --- WEBRTC & SLIDING PANEL ---
        function togglePanel() {
            document.getElementById('call-panel').classList.toggle('open');
        }

        async function startCall() {
            if(isInCall) { togglePanel(); return; }
            printLog("SYSTEM", "INITIALIZING ENCRYPTED FEED...");
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                isInCall = true;
                
                document.getElementById('call-panel').classList.add('open');
                document.getElementById('panel-toggle').style.display = 'inline-block';
                addVideoNode(localStream, username, true);

                publish(signalTopic, { type: 'call-init', sender: username });
            } catch(e) { printLog("ERROR", "HARDWARE ACCESS DENIED."); }
        }

        function leaveCall() {
            if(localStream) { localStream.getTracks().forEach(t => t.stop()); localStream = null; }
            Object.values(peers).forEach(p => p.close());
            peers = {};
            
            document.getElementById('call-panel').classList.remove('open');
            document.getElementById('panel-toggle').style.display = 'none';
            document.getElementById('video-grid').innerHTML = '';
            
            publish(signalTopic, { type: 'call-left', sender: username });
            isInCall = false;
            printLog("SYSTEM", "LINK SEVERED.");
        }

        // --- SIGNALING ---
        async function handleSignal(data) {
            if(data.sender === username) return;

            switch(data.type) {
                case 'call-init':
                    printLog("SYSTEM", `INCOMING SECURE FEED FROM ${data.sender}.`);
                    printLog("SYSTEM", `<button onclick="joinCall('${data.sender}')" style="background:var(--term-green);border:none;cursor:pointer;font-weight:bold;">[ JOIN FEED ]</button>`, true);
                    SoundFX.alert();
                    break;
                case 'join-req':
                    if(isInCall) createPeer(data.sender, true);
                    break;
                case 'offer':
                    if(isInCall) handleOffer(data.sender, data.sdp);
                    break;
                case 'answer':
                    if(isInCall && peers[data.sender]) peers[data.sender].setRemoteDescription(new RTCSessionDescription(data.sdp));
                    break;
                case 'ice':
                    if(isInCall && peers[data.sender]) peers[data.sender].addIceCandidate(new RTCIceCandidate(data.candidate));
                    break;
                case 'call-left':
                    if(peers[data.sender]) {
                        peers[data.sender].close(); delete peers[data.sender];
                        removeVideoNode(data.sender);
                        printLog("SYSTEM", `${data.sender} DISCONNECTED FEED.`);
                    }
                    break;
            }
        }

        async function joinCall() {
            if(isInCall) { togglePanel(); return; }
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                isInCall = true;
                document.getElementById('call-panel').classList.add('open');
                document.getElementById('panel-toggle').style.display = 'inline-block';
                addVideoNode(localStream, username, true);
                publish(signalTopic, { type: 'join-req', sender: username });
            } catch(e) { printLog("ERROR", "HARDWARE ACCESS DENIED."); }
        }

        function createPeer(target, initiator) {
            const pc = new RTCPeerConnection(rtcConfig);
            peers[target] = pc;
            localStream.getTracks().forEach(t => pc.addTrack(t, localStream));

            pc.onicecandidate = e => { if(e.candidate) publish(signalTopic, { type: 'ice', sender: username, target: target, candidate: e.candidate }); };
            pc.ontrack = e => { if(!document.getElementById('vid-'+target)) addVideoNode(e.streams[0], target, false); };

            if(initiator) {
                pc.createOffer().then(o => { pc.setLocalDescription(o); publish(signalTopic, { type: 'offer', sender: username, target: target, sdp: o }); });
            }
            return pc;
        }

        async function handleOffer(sender, sdp) {
            const pc = createPeer(sender, false);
            await pc.setRemoteDescription(new RTCSessionDescription(sdp));
            const ans = await pc.createAnswer();
            await pc.setLocalDescription(ans);
            publish(signalTopic, { type: 'answer', sender: username, target: sender, sdp: ans });
        }

        // --- VIDEO UI ---
        function addVideoNode(stream, label, muted) {
            const div = document.createElement('div');
            div.className = 'vid-container';
            div.id = 'vid-' + label;
            const v = document.createElement('video');
            v.srcObject = stream; v.autoplay = true; v.playsInline = true; if(muted) v.muted = true;
            div.innerHTML = `<div class="vid-label">${label}</div>`;
            div.prepend(v);
            document.getElementById('video-grid').appendChild(div);
        }
        function removeVideoNode(label) { const el = document.getElementById('vid-'+label); if(el) el.remove(); }
        
        function toggleMute() {
            if(localStream) {
                localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
                document.getElementById('btn-mute').classList.toggle('btn-active');
            }
        }
        function toggleCam() {
            if(localStream) {
                localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;
                document.getElementById('btn-cam').classList.toggle('btn-active');
            }
        }

    </script>
</body>
</html>
